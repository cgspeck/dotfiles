
common() {
  export AWS_DEFAULT_REGION=us-east-1
  export AWS_REGION=us-east-1
  export RUBY_ENV=development

  # aliases
  source ~/.bash_custom_aliases

  # z directory jumper
  if [ -f "$HOME/src/z/z.sh" ]; then
    source ~/src/z/z.sh
  else
    echo "Please clone z directory jumper to /src (git@github.com:rupa/z.git)"
  fi
}

common_tail() {
  eval "$(nodenv init -)"
}

osx() {
  if [ -f "$(brew --prefix)/opt/bash-git-prompt/share/gitprompt.sh" ]; then
    __GIT_PROMPT_DIR=$(brew --prefix)/opt/bash-git-prompt/share
    source "$(brew --prefix)/opt/bash-git-prompt/share/gitprompt.sh"
  fi
  source /usr/local/opt/chruby/share/chruby/chruby.sh
  source /usr/local/opt/chruby/share/chruby/auto.sh
}

ubuntu() {
  if [ -f "/opt/bash-git-prompt/gitprompt.sh" ]; then
    __GIT_PROMPT_DIR=/opt/bash-git-prompt
    source "/opt/bash-git-prompt/gitprompt.sh"
  else
    echo "Please install gitprompt using the install script in dotfiles"
  fi

  if [ -f "/usr/local/share/chruby/chruby.sh" ]; then
    source /usr/local/share/chruby/chruby.sh
    source /usr/local/share/chruby/auto.sh
  else
    echo "Please install chruby via the package manager"
  fi

  if [ -f "$HOME/.nodenv/bin/nodenv" ]; then
    export PATH="$HOME/.nodenv/bin:$PATH"
  else
    echo "Please install nodenv to ~/.nodenv"
  fi
}

common

case "$OSTYPE" in
  darwin*)
    echo "Setting up OSX (Homebrew) environment"
    osx
  ;;
  linux*)
    echo "Setting up Ubuntu environment"
    ubuntu
  ;;
  *)
    echo "unknown: $OSTYPE"
  ;;
esac

common_tail

[ -r ~/.bash_local ] && source ~/.bash_local
